doctype html
html(lang="en")
	head
		title Localisation Helper
		link(rel="stylesheet", href="css/main.css")
		link(rel="stylesheet", href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css")
	body
		#container.visible
			#navmenu
				button#go-to-manager
					a(href="/") Manager
				button#create-zip
					a(href="/zip?key=1LhZbstNbIyPyzwMSJyZyAmWPwtw0Uwg5aSPUaAu370s") Get ZIP
				button#get-diff Get DIFF
			#content.scrollBarBox
				textarea#result(style="margin: 0px;width: 1019px;height: 477px;")

		include templates/diff-template
		script(type="text/javascript", src="http://code.jquery.com/jquery-2.1.0.min.js")
		script(type="text/javascript", src="https://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.js")
		script(type="text/javascript", src="lib/underscore.js")
		script(type="text/javascript").
			$(document).ready(function() {
				$('#get-diff').click(function() {
					$.getJSON('/diff', function(response) {
						if(response.status === 'ok') {
							var data = response.data;
							var update = _.groupBy(_.where(data, {type: 'update'}), function(item) {
								return item.lang;
							});
							var add = _.groupBy(_.where(data, {type: 'add'}), function(item) {
								return item.project;
							});
							data = {
								update: update,
								add: add
							};

							var template = $('#diff-template');
							$('#content').html(template.tmpl(data));
						}
					});
				});
			});